# 🧾TIL
## 날짜: 2025-02-14

## 새로 배운 내용
|  | 정의 |
| --- | --- |
| Stateful | 서버가 클라이언트의 상태를 보존하는 것 |
| Stateless | 서버가 클라이언트의 상태를 보존하지 않는 것 |

## Stateful 예시

- **`TCP`** 연결 (3-WAY handshaking)

Server와 Client는 3-way handshaking 과정에서 **SYN**과 **SYN-ACK**을 주고 받으며 세션 상태를 established한 상태로 만든다. 이후 client와 server는 데이터를 주고 받을 수 있다.

따라서 TCP는 세션 상태를 기억에 뒀다가, 이에 따라 Server의 응답이 달라지는 Stateful한 프로토콜이다.

- TCP 상태 정보는 어디에서 관리할까?
    
    TCP의 상태 정보는 **운영체제 커널의 TCP 소켓 테이블과 TCB**에서 관리
    

## Stateless  예시

- `HTTP` : 글을 뛰어 넘는 글을 전송하는 통신 규약
    
    HTTP는 **Stateless**한 프로토콜이다. 그 이유는 다음과 같다.
    
    | 요청 간 독립성 | 각 요청들은 이전 요청과는 독립적으로 수행된다. 따라서 특정 요청이 실패해도 다른 요청에 영향을 덜 미치게 된다. |
    | --- | --- |
    | 로드 밸런싱 용이 | 서버가 클라이언트의 상태를 저장하지 않으므로 요청을 쉽게 다른 서버로 분산시킬 수 있다. (Stateful의 경우 세션 정보가 없는 서버에 분산시키지 않도록 로드 밸런서를 관리해야 한다.) |
    | 확장성 | 서버가 클라이언트의 이전 상태를 기억하지 않으므로 확장하기 쉽다. (세션 정보가 있다면 확장 시 따로 옮겨 주는 작업을 해야 한다.) |

## TCP와 HTTP의 관계

TCP는 클라이언트와 서버를 독립적으로 연결 후 데이터를 전송할 수 있지만, HTTP는 Stateless하다고 앞서 언급한 것처럼 클라이언트와의 연결 정보를 저장하지 않는다.

따라서 HTTP는 일반적으로 TCP 연결 내에서 데이터를 전송한다. 

**TCP로 연결을 한  뒤, 그 안에서 여러 HTTP 요청/응답이 독립적으로 오간다**고 이해하는 것이 쉽다.

그렇다면 왜 이러한 방식을 사용할까? TCP 프로토콜만 사용하면 안될까?

TCP는 OSI 7 Layer에서 전송 계층으로, HTTP가 속하는 응용 계층보다 하위에 있다. 따라서 TCP만 사용하면 전송 계층보다 상위 계층들이 담당하는 일을 개발자가 직접 구현해야한다.

TCP는 패킷 전송과 흐름 제어, 오류 검출 등의 기능만 제공하며, HTTP와 같은 상위 계층 프로토콜이 처리하는 요청/응답 방식, 데이터 형식, 상태 유지 기능 등을 지원하지 않는다.

TCP만 사용할 경우, 웹에서 사용되는 텍스트 기반 요청/응답 프로토콜을 직접 구현해야 한다.

## 웹 어플리케이션이 사용자 상태를 유지하기 위한 방법

### **(1) 쿠키**

정의

- **서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각**

동작 방식

- 서버가 전송한 쿠키를 브라우저(클라이언트)에서 저장해 놓았다가, 동일한 서버에 재 요청 시 브라우저가 Request Header에 넣어서 자동으로 서버에 전송

종류

- 세션 쿠키 (`Expires`, `Max-Age` 속성이 없는 쿠키)는 현재 세션이 끝날 때 삭제된다. 일반적으로 브라우저를 닫으면 사라진다.
- 영속적인 쿠키는 `Expires` 속성에 명시된 날짜에 삭제되거나, `Max-Age` 속성에 명시된 기간 이후에 삭제된다.

단점

- 모든 요청마다 쿠키가 함께 전송되기 때문에, (특히 mobile data connections에서) 성능이 떨어지는 원인이 될 수 있다.
- **`XSS 공격 취약`** : 클라이언트 측에 저장되기 때문에 XSS(크로스 사이트 스크립팅) 공격이나 쿠키 탈취 등의 보안 위협에 노출 ⇒ 중요한 정보는 쿠키에 저장하지 않고, 가능하다면 HTTPS를 통해 쿠키를 전송하며, **HttpOnly**와 **Secure** 속성을 쿠키에 설정해야 한다.
    
    
    - HttpOnly : JavaScript의 [`Document.cookie`](https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie) API로 쿠키에 접근할 수 없다. (보안성 향상)
    - Secure : HTTPS 프로토콜로만 쿠키 전송 가능

---

### (2) 세션

- 서버와 클라이언트 간의 상태를 저장하는 기술
- 세션은 쿠키를 기반으로 한다.(세션 ID를 세션 쿠키에 보관)
- 쿠키 방식에 비해 보안 유리
- 브라우저를 종료하면 세션 쿠키 특성 상 자동으로 삭제

동작 방식

1. 사용자가 로그인하면 서버는 고유한 세션 ID를 생성하고 이를 쿠키에 저장하여 클라이언트에 전송한다.
2. 이후 클라이언트가 서버에 요청을 보낼 때마다 세션 ID가 담긴 쿠키가 함께 자동으로 전송된다.
3. 서버는 쿠키의 세션 ID를 전달 받아 세션 ID를 기반으로 세션을 검색해, 세션에 있는 클라이언트 정보를 꺼내서 사용한다. 
    
    **세션 정보 자체는 서버(WAS), 데이터베이스(DB), 인메모리 저장소(Redis) 등에서 관리**될 수 있다.
    
    특히 데이터베이스나 인 메모리 저장소의 경우 서버의 부하를 줄이고, 세션 정보의 안정적인 관리가 가능하다.
    

단점

- 매 요청마다 쿠키의 세션 ID를 기반으로 사용자 데이터를 검색해야 한다.
- 사용자가 많아질수록 서버의 부하가 증가한다.

---

### (3) 웹 스토리지

1. **로컬스토리지**: 영구적인 로컬 스토리지를 제공하며, 브라우저를 닫아도 데이터가 유지된다. 동일한 도메인의 모든 페이지 간에 데이터를 공유할 수 있다.
    
    클라이언트에 영구적인 데이터를 저장할 때 용이하다.
    

1. **세션스토리지**: 세션 스토리지는 브라우저의 탭 별로  생성되며 데이터를 공유하지 않는다. 또한 같은 탭이라도 도메인이 다르면 또 다른 세션 스토리지가 생성된다.
    
    
    | 도메인 | `sessionStorage` 데이터 |
    | --- | --- |
    | `https://example.com` | `key=value1` |
    | `https://example.com:8080` | (비어 있음) |
    | `https://sub.example.com` | (비어 있음) |
    
    **같은 탭이어도 도메인(`example.com` vs `sub.example.com`)이 다르면 데이터가 공유되지 않는다.**
    
    **포트(`:8080`)가 다르면 동일한 사이트라도 세션 스토리지를 공유하지 않는다.**
    
    임시적인 데이터 보관이나, 사용자 폼 임시 입력 등을 저장할 때 사용될 수 있다.

## 정적 웹 페이지

: 정적 웹 페이지는 **미리 만들어진 HTML, CSS, JavaScript 파일을 그대로 브라우저에 전달하는 방식**

- 회사 소개 페이지, 포토폴리오 페이지 등의 고정된 웹 페이지
- 렌더링 속도 빠름
- 인터랙션이나 실시간 성 데이터를 보여줄 수 없음
- SEO에 유리하다 (미리 만들어진 파일이기 때문)

## 동적 웹  페이지

: 동적으로 만들어지는 웹 페이지. 사용자의 요청에 따라 페이지가 달라진다.

- 서비스가 다양함
- 서버 부하 관리 필요
- 구현 복잡

### 오늘의 회고
오늘은 HTTP가 Stateless한 이유와 이를 보완하기 위한 웹 기술들에 대해서 살펴보았다.

공부하면 할수록 모르는 키워드들이 계속 등장해서 정리하는데 꽤나 오래 걸렸다.

특히, 쿠키를 서버에서 클라이언트에 전송하면(Set-Cookie), 클라이언트에서는 자동으로 같은 요청마다 쿠키를 실어서 가져온다는 것이 신기했다.

또한 쿠키와 세션의 차이에 대해서 모호하게 알고 있었는데, 쿠키가 세션에 사용되는 개념이라는 것도 처음 알게 되었다.

사용자가 로그인에 성공하면 세션 ID를 서버에서 생성하고, 쿠키에 담아서 클라이언트에 보내면 클라이언트는 매 요청마다 

쿠키와 함께 세션 ID를 가지고 오게 되는 것이다. 그러면 서버가 사용자를 식별할 수 있게 되고, 해당 ID를 기반으로 

세션 정보를 조회한다. 다음으로 세션 정보를 서버에 저장한다는 것은 알았지만 구체적으로 어디에 저장할까?에 대해서도 의문이 생겼다.

알아본 결과, 웹 어플리케이션 서버의 메모리에 저장되는 경우와, 외부 데이터베이스에 저장하는 경우 그리고 Redis 같은 인 메모리 데이터베이스에 저장 가능하다는 것도 알게 되었다.

웹 스토리지 같은 경우는 웹 어플리케이션을 개발하며 종종 사용했던 로컬 스토리지와, 세션 스토리지에 대한 내용을 학습했다.

세션 스토리지가 브라우저의 탭마다 새로 생기며, 같은 탭이어도 도메인이 다르면 새롭게 만들어진다는 점을 알게 되었다.

오늘은 매우 힘들지만 뿌듯한 날이다.

모두 어렴풋이 들어서 알고 있었던 웹 지식들이지만, 깊이 알지 못해 프로젝트 개발 시 어려움이 있었던 내용들이다.

그때의 공부하겠다는 다짐들을 오늘에서야 지키게 되어 아쉽지만, 꼬리에 꼬리를 무는 질문들이 잘 이루어진 것 같아서 더 만족스럽다🥰



### 참고 자료 및 링크
